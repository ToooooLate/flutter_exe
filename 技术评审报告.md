# 青芝发动机性能参数监控系统 - 技术评审报告

## 项目概述

青芝发动机性能参数监控系统是一个跨平台的工业监控解决方案，采用Flutter桌面应用内嵌WebView的架构，结合Vue.js前端技术栈，实现发动机性能参数的实时监控、实验管理和数据分析功能。

### 项目架构

项目分为两个主要部分：

1. **Flutter桌面应用** (`desktop/`)：Windows系统下的桌面容器，负责WebView承载和网络检测
2. **Web业务应用** (`web/`)：基于Vue 3 + Vben Admin的前端业务系统，实现核心功能

## 第一部分：Flutter桌面应用

### 技术栈
- **Flutter 3.x** - 跨平台桌面应用框架
- **webview_flutter 4.8.0** - WebView组件，Windows平台使用Edge WebView2
  （需要提供window开发测试环境，确保Edge WebView2已安装，尽量贴合现场实际生产环境，系统和配置接近）
- **connectivity_plus 6.0.3** - 网络连接状态检测
- **http 1.2.1** - HTTP请求客户端

### 核心功能实现

#### 1. 应用配置管理
```json
// assets/config/app.json
{
  "webBaseUrl": "http://192.168.120.55:5888/",
  "healthCheckPath": "auth/login",
  "timeoutMs": 3000
}
```

#### 2. 启动流程与网络检测
- **配置加载**：从`assets/config/app.json`读取目标服务器配置
- **健康检查**：向`webBaseUrl + healthCheckPath`发送HTTP GET请求
- **网络状态检测**：使用`connectivity_plus`检测基础网络连接
- **错误处理**：提供重试机制和用户友好的错误提示

#### 3. WebView容器
- **导航限制**：仅允许在配置的域名下导航，防止外链跳转
- **缓存控制**：禁用缓存确保获取最新内容
- **安全策略**：启用JavaScript但限制导航范围

### 部署特性
- **Windows兼容性**：依赖Microsoft Edge WebView2 Runtime
- **配置热更新**：通过修改配置文件更新目标地址，无需重新编译
- **分发便捷性**：`build/windows/runner/Release/`目录可直接分发

## 第二部分：Web业务应用

### 技术栈
- **Vue 3** + **TypeScript** - 现代前端框架
- **Vite** - 构建工具
- **Vben Admin v5** - 企业级管理后台框架
- **Ant Design Vue** - UI组件库
- **Vue Router** - 路由管理
- **Pinia** - 状态管理

### 项目结构
```
web/
├── apps/web-antd/          # 主应用
├── packages/               # 共享包
│   ├── @core/             # 核心功能
│   ├── constants/         # 常量定义
│   ├── locales/           # 国际化
│   ├── preferences/       # 偏好设置
│   └── stores/            # 状态管理
└── docs/                  # 文档
```

## 功能实现分析

### 第一阶段：基础交互功能

#### 路由配置
基于Vue Router实现的动态路由系统：

**核心路由** (`router/routes/core.ts`)：
- 根路由 (`/`) - 基础布局容器
- 认证路由 (`/auth`) - 登录、注册、忘记密码等

**实验模块路由** (`router/routes/modules/experiment.ts`)：
- `/experiment` - 实验管理主页面
- `/experiment/current` - 当前实验详情页面

#### 组件结构

**实验管理页面** (`views/experiment/current/index.vue`)：
- **实验操作区**：新建实验、结束实验、废弃实验、报告预览、数据同步
- **实验设置区**：测试人员、设备参数、连接配置等
- **实验流程区**：11个实验步骤的标签页切换

**实验步骤组件**：
1. `TestEnvironment.vue` - 试验环境监控
2. `AppearanceInspection.vue` - 外观检查
3. `ColdInsulationTest.vue` - 冷态绝缘电阻测量
4. `StartupPerformanceTest.vue` - 启动性能试验
5. `OperationInspection.vue` - 机组运转检查
6. `ProtectionDeviceTest.vue` - 机组保护装置试验
7. `LoadTest.vue` - 负载试验
8. `SteadyStateTest.vue` - 稳态试验
9. `FluctuationTest.vue` - 波动试验
10. `TransientTest.vue` - 瞬态实验
11. `HotInsulationTest.vue` - 热态绝缘电阻测量

#### 状态管理
- **实验状态**：实验编号、实验设置、按钮状态管理
- **标签页状态**：左侧实验流程标签页、右侧监控标签页
- **用户认证**：基于Token的认证机制

### 第二阶段：图表报告功能（规划中）

#### 图表展示
- **实时数据图表**：基于ECharts的时序数据可视化
- **性能指标仪表盘**：转速、扭矩、功率、温度等关键指标
- **历史数据分析**：趋势分析、对比分析

#### 文件下载功能
- **报告生成**：PDF格式的实验报告
- **数据导出**：Excel格式的原始数据
- **图表导出**：PNG/SVG格式的图表文件

### 第三阶段：远程访问与权限管理（规划中）

#### 三级权限体系

**一类账号 - 现场操作员**：
- 创建/删除实验的完整权限
- 下发控制指令
- 访问所有功能模块
- 生成临时访问密码

**二类账号 - 内部人员**：
- 查询历史数据权限
- 查看所有实验数据
- 无法操作实验或下发指令
- 只读访问权限

**三类账号 - 客户**：
- 基于实验编号的临时访问（24小时有效）
- 仅可查看指定实验的数据和报告
- 无任何操作权限
- 由一类账号生成访问凭证

#### 实时数据更新
- **轮询机制**：1秒间隔的数据轮询
- **WebSocket连接**：实时数据推送（备选方案）
- **数据同步**：三端数据实时同步

## 技术特性

### 权限管理系统
```typescript
// 基于角色的访问控制 (RBAC)
const userRoles = userInfo.roles ?? [];
const { accessibleMenus, accessibleRoutes } = await generateAccess({
  roles: userRoles,
  router,
  routes: accessRoutes,
});
```

### 国际化支持
- **中英文双语**：完整的i18n配置
- **动态语言切换**：运行时语言切换
- **本地化适配**：日期、数字格式本地化

### 响应式布局
- **左右分栏布局**：左侧实验流程（75%）+ 右侧监控面板（25%）
- **自适应设计**：支持不同屏幕尺寸
- **组件化设计**：高度可复用的组件架构

### 安全特性
- **Token认证**：JWT Token + Refresh Token机制
- **路由守卫**：基于权限的路由访问控制
- **请求拦截**：统一的API请求/响应处理
- **域名限制**：WebView导航限制在指定域名

## 开发状态总结

### 已完成功能
✅ Flutter桌面应用框架搭建  
✅ WebView容器与网络检测  
✅ Vue.js前端项目初始化  
✅ 实验管理页面基础框架  
✅ 11个实验步骤组件骨架  
✅ 左右分栏响应式布局  
✅ 权限管理与路由守卫  
✅ 国际化配置  

### 开发中功能
🔄 实验数据模型设计  
🔄 API接口定义与Mock数据  
🔄 实验流程业务逻辑  

### 待开发功能
⏳ ECharts图表集成  
⏳ 文件下载功能  
⏳ 三级权限体系实现  
⏳ 实时数据轮询机制  
⏳ 报告生成与预览  
⏳ 视频监控功能  

## 技术风险与建议

### 风险点
1. **跨平台兼容性**：WebView2在不同Windows版本的兼容性
2. **网络稳定性**：工业环境下的网络连接稳定性
3. **实时性能**：1秒轮询的性能影响
4. **数据安全**：工业数据的传输与存储安全

### 优化建议
1. **缓存策略**：实现智能缓存减少网络请求
2. **错误恢复**：增强网络异常的自动恢复机制
3. **性能监控**：添加性能指标监控
4. **安全加固**：数据传输加密与访问日志记录

## 结论

项目整体架构设计合理，技术选型适当，已完成的基础框架为后续功能开发奠定了良好基础。建议按照三阶段计划逐步推进，重点关注实时数据处理和权限管理的实现质量。

---

**报告生成时间**：2025年10月13日  
**项目版本**：v1.0.0-dev  
**评审人员**：技术团队